/* duplicate Builder Images.*/
select I.id  from  Image I JOIN ImageType IT ON (I.imagetype_id=IT.id) JOIN ( select Im.original_hash, OTm.id from Image Im JOIN ImageType ITm ON (Im.imagetype_id=ITm.id) JOIN ObjectType OTm ON (ITm.objecttype_id=OTm.id AND OTm.type="builder") where Im.active = 1 group by Im.original_hash, OTm.id having count(*) > 5 ) T ON (I.original_hash = T.original_hash and IT.objecttype_id = T.id)  INTO OUTFILE '/tmp/duplicateBuilderImage.csv' ;
Select I.id from Image I JOIN Image DI ON (I.original_hash=DI.original_hash) where DI.id in (4644,2757,388702,374700,4166,3298,141661,1170,5143,179308,4450,2600,1731) and I.imagetype_id = 13 and I.active = 1 INTO OUTFILE '/tmp/duplicateBuilderImage1.csv';
/* deleting duplicate images across builders.*/
update Image I JOIN ImageType IT ON (I.imagetype_id=IT.id) JOIN ( select Im.original_hash, OTm.id from Image Im JOIN ImageType ITm ON (Im.imagetype_id=ITm.id) JOIN ObjectType OTm ON (ITm.objecttype_id=OTm.id AND OTm.type="builder") where Im.active = 1 group by Im.original_hash, OTm.id having count(*) > 5 ) T ON (I.original_hash = T.original_hash and IT.objecttype_id = T.id) set I.active = 0;

update Image I JOIN Image DI ON (I.original_hash=DI.original_hash) set I.active = 0 where DI.id in (4644,2757,388702,374700,4166,3298,141661,1170,5143,179308,4450,2600,1731) and I.imagetype_id = 13 and I.active = 1;

/* duplicate Project Images.*/
select I.id  from  Image I JOIN ImageType IT ON (I.imagetype_id=IT.id) JOIN ( select Im.original_hash, OTm.id from Image Im JOIN ImageType ITm ON (Im.imagetype_id=ITm.id) JOIN ObjectType OTm ON (ITm.objecttype_id=OTm.id AND OTm.type="project") where Im.active = 1 group by Im.original_hash, OTm.id having count(*) > 4 ) T ON (I.original_hash = T.original_hash and IT.objecttype_id = T.id)  INTO OUTFILE '/tmp/duplicateProjectImage.csv' ;

select I.id from Image I JOIN Image DI ON (I.original_hash=DI.original_hash) JOIN ImageType IT ON (I.imagetype_id = IT.id) where DI.id in (288512,281265,281341,384466,280194,280223,281814,259771,281654,283091,303155,324698,281790,312897,281981,282768,261477,281634,291505,316961,284350,305054,408947,367073,288474,311750,357043,349662,281505,348270,275906,261053,401545,359608,247504,321776,238972,396004,281836,382643,264672,290395,364792,259927,301970,378125,349591,281742,254862,348834,340372,281251,259727,399160,250432,345149,252115,319811,386241,401549,374891,278911,255123,258589,409993,344169,387804,319399,255257,257109) and I.active = 1 and IT.objecttype_id =  1 INTO OUTFILE '/tmp/duplicateProjectImage1.csv';

select I.id from Image I JOIN Image DI ON (I.original_hash=DI.original_hash) JOIN ImageType IT ON (I.imagetype_id = IT.id) where DI.id in (364678,336719,395785,257580,290398,353275,329123,274945,273930,390657,251724) and I.active = 1 AND I.object_id IN (645060,642089,643581,653905,501255,642304,502306,500161,506390,648696,644967) and IT.objecttype_id = 1 INTO OUTFILE '/tmp/duplicateProjectImages2.csv';

/* deleting duplicate images across projects.*/
update Image I JOIN ImageType IT ON (I.imagetype_id=IT.id) JOIN ( select Im.original_hash, OTm.id from Image Im JOIN ImageType ITm ON (Im.imagetype_id=ITm.id) JOIN ObjectType OTm ON (ITm.objecttype_id=OTm.id AND OTm.type="project") where Im.active = 1 group by Im.original_hash, OTm.id having count(*) > 4 ) T ON (I.original_hash = T.original_hash and IT.objecttype_id = T.id) set I.active = 0;

update Image I JOIN Image DI ON (I.original_hash=DI.original_hash) JOIN ImageType IT ON (I.imagetype_id=IT.id) set I.active = 0 where DI.id in (288512,281265,281341,384466,280194,280223,281814,259771,281654,283091,303155,324698,281790,312897,281981,282768,261477,281634,291505,316961,284350,305054,408947,367073,288474,311750,357043,349662,281505,348270,275906,261053,401545,359608,247504,321776,238972,396004,281836,382643,264672,290395,364792,259927,301970,378125,349591,281742,254862,348834,340372,281251,259727,399160,250432,345149,252115,319811,386241,401549,374891,278911,255123,258589,409993,344169,387804,319399,255257,257109) and I.active = 1 and IT.objecttype_id = 1;

update Image I JOIN Image DI ON (I.original_hash=DI.original_hash) JOIN ImageType IT ON (I.imagetype_id = IT.id) set I.active = 0 where DI.id in (364678,336719,395785,257580,290398,353275,329123,274945,273930,390657,251724) and I.active = 1 AND I.object_id IN (645060,642089,643581,653905,501255,642304,502306,500161,506390,648696,644967) and IT.objecttype_id = 1;
